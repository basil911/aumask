#summary Discussion on color spaces used in aumask.

= Algorithm of advanced unsharp mask =

Goal of this wiki is to 

  # explain how RGB values are processed
  # provide room for discussion and description of implementation of other color modes - as required by users

This page is to be continuously worked on and added.

= Current processing as by 0.6.3 version: =

following variables are used in explanation
{{{
gint Rint,Gint,Bint          # RGB values 0 - 255 as stored in common RGB images, these are input and output 
                             #values for the plugin
gfloat Rfloat,Gfloat,Bfloat  # RGB values converted to range 0-1, during processing can get out 
                             # of this range (no problem mathematically)
gfloat avg,new_avg           #brightness (or call it whatever you what) of individual pixel, initially in the
                             # range 0-1, but after processing can get out of this range, avg is orignal,
                             # avg_new is final brightness
}}}

1. RGB values are gammed and converted to float in range 0-1

{{{
   Rfloat=(Rint/255)^(1/2.2)
   Gfloat=(Gint/255)^(1/2.2) 
   Bfloat=(Bint/255)^(1/2.2) 
}}}

2. brightness is calculated 
{{{
   avg=(R+G+B)/3                    #0.6.4 and before
   avg=0.299*R + 0.587*G + 0.114*B  #0.6.5 and on
}}}
(this is to be changed for wighted average in next version)

3. new brightness (avg_new) is calculated (description how is not subject of this page)


4. New Rfloat, Gfloat,Bfloat are caluclated:

{{{
   Rfloat= avg_new+Rfloat-avg
   Gfloat= avg_new+Gfloat-avg
   Bfloat= avg_new+Bfloat-avg
}}}
5. RGB (floats) are converted back to integers in range 0-255

{{{   
  Rint=ROUND( (Rfloat ^ 2.2) * 255 )
  Gint=ROUND( (Gfloat ^ 2.2) * 255 )
  Bint=ROUND( (Bfloat ^ 2.2) * 255 )
}}}

values below 0 and above 255 are clipped.